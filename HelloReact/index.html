<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>React project</title>

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="background"></div>
  <div id="root"></div>

  <script src="keygenerator.js" type="text/javascript"></script>
  <script src="lib/react.development.js"></script>
  <script src="lib/react-dom.development.js"></script>
  <script src="lib/babel.min.js"></script>
  <script type="text/babel">

  let text_header = 'ReactJS.';

  let text_main = [
    {
      id: '1',
      title: 'First title',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit'
    },
    {
      id: '2',
      title: 'Second title',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit'
    },
    {
      id: '3',
      title: 'Third title',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit'
    }
  ];

  let left_datas = [
    {
      id: '1',
      title: 'Left 1',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit',
      fullText: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit. Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit. Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit.'
    },
    {
      id: '2',
      title: 'Left 2',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit',
      fullText: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit. Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit. Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit.'
    },
    {
      id: '3',
      title: 'Left 3',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit',
      fullText: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit. Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit. Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit.'
    }
  ];

  let right_datas = [
    {
      id: '1',
      title: 'Left 1',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit'
    },
    {
      id: '2',
      title: 'Left 2',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit'
    },
    {
      id: '3',
      title: 'Left 3',
      text: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit consectetur adipisicing elit'
    }
  ];

  const comments = [];

  class Header extends React.Component {
    render() {
      return (
        <header className="header">
          <h1>{ text_header }</h1>
        </header>
      )
    }
  }

  class LeftNews extends React.Component {
    state = {
      visible: false,
    }

    showMoreText = (event) => {
      event.preventDefault();
      this.setState({visible: true});
    }

    hideMoreText = (event) => {
      event.preventDefault();
      this.setState({visible: false});
    }

    render() {
      const { title, text, fullText } = this.props.data;
      const { visible } = this.state;

      return (
        <div className="side-container">
          <h3 className="side-container__title">{ title }</h3>
          {
            visible ?
              <p className="side-container__text">
                { fullText }
                <a href="#" onClick={this.hideMoreText}> Hidden </a>
              </p> :
              <p className="side-container__text">
                { text }
                <a href="#" onClick={this.showMoreText}> Show more </a>
              </p>
          }
        </div>
      )
    }
  }

  class LeftColumn extends React.Component {
    render() {
      const data = this.props.data;
      let news = '';

      if (data.length) {
        news = data.map(item => {
          return (
            <LeftNews key={ item.id } data={ item }/>
          )
        })
      } else {
        news = (
          <div className="side-container">
            <p>You have not news.</p>
          </div>
        )
      }

      return (
        <section className="left-column">
          { news }
        </section>
      )
    }
  }

  class RightNews extends React.Component {
    render() {
      const { title, text } = this.props.data;
      return (
        <div className="side-container">
          <h3 className="side-container__title">{ title }</h3>
          <p className="side-container__text">{ text }</p>
        </div>
      )
    }
  }

  class RightColumn extends React.Component {
    render() {
      const data = this.props.data;
      let news = '';

      if (data.length) {
        news = data.map(item => {
          return (
            <RightNews key={ item.id } data={ item }/>
          )
        })
      } else {
        news = (
          <div className="side-container">
            <p>You have not news.</p>
          </div>
        )
      }

      return (
        <section className="right-column">
          { news }
        </section>
      )
    }
  }

  class News extends React.Component {
    render() {
      const { title, text } = this.props.data;
      return (
        <div className="news-container">
          <h2>{ title }</h2>
          <p>{ text }</p>
        </div>
      )
    }
  }

  class MainColumn extends React.Component {
    render() {
      const { data } = this.props;
      let news = '';

      if (data.length > 0) {
        news = data.map(item => {
          return (
            <News data={ item } key={ item.id }/>
          )
        })
      } else {
        news = (
          <div className="news-container">
            <p>You have not news.</p>
          </div>
        )
      }

      return (
        <section className="main-column">
          { news }
        </section>
      )
    }
  }

  class Container extends React.Component {
    render() {
      return (
        <div className="container">
          <LeftColumn data={ left_datas }/>
          <MainColumn data={ text_main } />
          <RightColumn data={ right_datas }/>
        </div>
      )
    }
  }

  class CommentsForm extends React.Component {
    state = {
      userName: "",
      userComment: "",
    }

    enterUserName = (event) => {
      this.setState({ userName: event.currentTarget.value })
    }

    enterUserComment = (event) => {
      this.setState({ userComment: event.currentTarget.value })
    }

    sendComment = (event) => {
      const userName = document.querySelector('#userName').value;
      const userComment = document.querySelector('#userComment').value;
      document.querySelector('#userComment').value = '';
      comments.push({ 'userName': userName,
                      'userComment': userComment });
    }

    render() {
      return (
        <form className="form">
          <input onChange={ this.enterUserName }
                 id="userName"
                 type="text"
                 className="form__input_name"
                 value={ this.state.userName }
                 placeholder="Enter your name" />
          <input onChange={ this.enterUserComment }
                 id="userComment"
                 type="text"
                 className="form__input_comment"
                 value={ this.state.userComment }
                 placeholder="Enter your comment" />
          <input type="button"
                 className="form__button"
                 value="Send"
                 onClick={ this.sendComment } />
        </form>
      )
    }
  }

  class NewComment extends React.Component {
    render() {
      const { userName, userComment } = this.props.data;
      return (
        <div>
          <div className="comment">
            <p className="comment__author">{ userName }</p>
            <p className="comment__text">{ userComment }</p>
          </div>
        </div>
      )
    }
  }

  class CommentsField extends React.Component {
    state = {
      data: ''
    }

    setComments = () => {
      this.setState({ data: comments });
    }

    getComments = () => {
      return this.state.data;
    }

    render() {
      const data = this.getComments();

      let dataLength = data.length;
      let commentsToDisplay = '';

      if (data.length === 0) {
        commentsToDisplay = <div className="comment"><p className="comment__text">No comments.</p></div>;
      } else {
        commentsToDisplay = data.map(comment => {
          return <NewComment key={ keygenerator() } data={ comment } />
        })
      }

      // Здесь имитация ajax, прием данных с сервера. Ожидание добавления нового комментария.
      setInterval(() => {
        if (comments.length !== dataLength) {
          dataLength = comments.length;
          this.setComments();
        }
      }, 1000);

      return (
        <React.Fragment>
          { commentsToDisplay }
        </React.Fragment>
      )
    }
  }

  class Messages extends React.Component {
    render() {
      return (
        <div>
          <CommentsForm />
          <CommentsField />
        </div>
      )
    }
  }

  class Footer extends React.Component {
    render() {
      return (
        <footer className="footer">
          <p>Footer</p>
        </footer>
      )
    }
  }

  const App = () => {
    return (
      <React.Fragment>
        <Header />
        <Container />
        <Messages />
        <Footer />
      </React.Fragment>
    )
  }

  ReactDOM.render(
    <App />,
    document.getElementById('root')
  );

  </script>
</body>
</html>
